<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <link href="DataTables-1.13.4/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="Select-1.6.2/css/select.dataTables.min.css" rel="stylesheet" />
    <link href="Buttons-2.3.6/css/buttons.dataTables.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
        integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <title>Tugas 10</title>
</head>

<body>

    <!-- modalTambahProduk -->
    <div class="modal fade" id="modalTambahProduk" tabindex="-1" role="dialog" aria-labelledby="modelTitleId"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="form-group col-md">
                    <label for="formNamaProduk">Nama Produk</label>
                    <input type="text" name="" id="formNamaProduk" class="form-control" placeholder="Nama Produk"
                        aria-describedby="helpId">
                    <label for="formKeterangan">Keterangan</label>
                    <input type="text" name="" id="formKeterangan" class="form-control" placeholder="Keterangan"
                        aria-describedby="helpId">
                    <label for="formHarga">Harga</label>
                    <input type="number" name="" id="formHarga" class="form-control" placeholder="Harga"
                        aria-describedby="helpId">
                    <label for="formJumlah">Jumlah</label>
                    <input type="number" name="" id="formJumlah" class="form-control" placeholder="Jumlah"
                        aria-describedby="helpId">
                    <button type="submit" name="" id="buttonFormTambahProduk"
                        class="btn btn-primary tn-lg btn-block mt-4">Tambah</button>
                </div>
            </div>
        </div>
    </div>

    <!-- modalHapusProduk -->
    <div class="modal fade" id="modalHapusProduk" tabindex="-1" role="dialog" aria-labelledby="modelTitleId"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="col-md py-3">
                    <h1>Anda yakin mau menghapus produk ini?</h1>
                    <h2 id="nama_produx"></h2>
                    <button type="button" name="" id="buttonModalHapusProduk" class="btn btn-danger tn-lg btn-block mt-4">Hapus</button>
                </div>
            </div>
        </div>
    </div>

<div class="container py-5">
    <div class="row">
        <div class="col-md">
            <h1>Implementasi Tugas 10</h1>
            <P>Slim PHP Micro Framework, Medoo DB Framework, Javascript, JQuerry Liblary, DataTable, Bootstrap Grid</P>
        </div>
    </div>
</div>
    <div class="container py-2">
        <div class="row">
            <div class="col-md">
                <table id="mytable" class="">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Produk</th>
                            <th>Keterangan</th>
                            <th>Harga</th>
                            <th>Jumlah</th>
                            <th>id</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Jquerry -->
    <script src="jQuery-3.6.0/jquery-3.6.0.min.js"></script>

    <!-- Datatable -->
    <script src="DataTables-1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="Select-1.6.2/js/dataTables.select.min.js"></script>
    <script src="Buttons-2.3.6/js/dataTables.buttons.min.js"></script>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"
        integrity="sha384-+sLIOodYLS7CIrQpBjl+C7nPvqq+FbNUBDunl/OZv93DB7Ln/533i8e/mZXLi/P+"
        crossorigin="anonymous"></script>
    
    <!-- Sweet Aleret -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


    <script>
        let getProduct = undefined;
        const mydt = $("#mytable").DataTable({
            select: true,
            dom: 'Bfrtip',
            ajax: {
                url: "/selectAll",
                method: "get",
                dataSrc: '',
            },
            columns: [
                { data: undefined },
                { data: 'nama_produk' },
                { data: 'keterangan' },
                { data: 'harga' },
                { data: 'jumlah' },
                { data: 'id' }
            ],
            order: [
                [5, "desc"]
            ],
            columnDefs: [
                {
                    target: 5,
                    visible: false,
                },
                {
                    target: 0,
                    order: false,

                }
            ],
            buttons: [
                {
                    text: 'Tambah Produk',
                    action: function () {
                        $('#modalTambahProduk').modal('show');
                    }
                },
                {
                    text: 'Hapus Produk',
                    action: function () {

                        $('#modalHapusProduk').modal('show')
                        getProduct = mydt.rows({ selected: true }).data()[0];
                        // $('#nama_produx').innerHTML = getProduct.nama_produk;
                        // console.log(getProduct.nama_produk);


                    }
                },
            ]
        });

        // Tombol DT tambahProduk
        $("#buttonFormTambahProduk").on("click", function () {
            tambahProduk();
            location.reload();

        });
        
        // Tombol DT hapusProduk
        $("#buttonModalHapusProduk").on("click", function () {
            hapusProduk(getProduct.id);
            location.reload();
        });

        // Numbering Datatable
        mydt.on('order.dt search.dt', function () {
            var i = 1;
            mydt.cells(null, 0, { search: 'applied', order: 'applied' }).every(function (cell) {
                this.data(i++);
            });
        }).draw();

        // Tweak Datatable disable error warning
        $.fn.dataTable.ext.errMode = 'none';
        mydt.on('error.dt', function (e, settings, techNote, message) {
            // console.log('An error has been reported by DataTables: ', message);
        });

        // Fungsi Hapus Produk
        function hapusProduk(id) {
            $.ajax({
                url: "/deleteProduk",
                method: "POST",
                data: {
                    idProduct: id,
                }
            });
        }

        // Fungsi Tambah Produk
        function tambahProduk() {

            let formNamaProduk = $("#formNamaProduk").val();
            let formKeterangan = $("#formKeterangan").val();
            let formHarga = $("#formHarga").val();
            let formJumlah = $("#formJumlah").val();

            $.ajax({
                url: "/insertProduk",
                method: "POST",
                data: {
                    namaProduk: formNamaProduk,
                    keterangan: formKeterangan,
                    harga: formHarga,
                    jumlah: formJumlah
                }
            });
        
        }


        // Ajax dengan result global
        //
        // let result = "";
        // $.ajax({
        //     url: "/selectAll",
        //     method: "GET",
        //     dataType: "json",
        //     success: function (data) {
        //         console.table(data)
        //         for (list of data) {
        //             result += list;
        //         }
        //     }
        // });
        // console.log(result);


        // Ajax Table tanpa DataTable
        //
        // $.ajax({
        //     url: "/selectAll",
        //     method: "GET",
        //     dataType: "json",
        //     success: function (data) {
        //         // console.table(data)
        //         for (list of data) {
        //             console.log(list)
        //             let table = document.getElementById("mytable");
        //             let row = table.insertRow(-1);
        //             let cell1 = row.insertCell(0);
        //             let cell2 = row.insertCell(1);
        //             let cell3 = row.insertCell(2);
        //             let cell4 = row.insertCell(3);
        //             // let cell5 = row.insertCell(4);
        //             cell1.innerHTML = list.nama_produk;
        //             cell2.innerHTML = list.keterangan;
        //             cell3.innerHTML = list.harga;
        //             cell4.innerHTML = list.jumlah;
        //         }
        //     }
        // });



    </script>

</body>

</html>